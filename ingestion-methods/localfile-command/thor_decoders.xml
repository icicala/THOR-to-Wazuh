<!-- =======================================================================
     THOR JSON â€“ parent + version-specific + default decoder
     Tested with Wazuh 4.12.0
     Created: June 12, 2025
     Last updated: June 23, 2025
     Maintainer: Ion Cicala ion.cicala@nextron-systems.com
========================================================================= -->

<decoder name="thor-json-v1">
  <parent>ossec</parent>
  <prematch offset="after_parent" type="pcre2">^output:\s+'.*thor_findings_etl\.py':\s*(?=\{)</prematch>
  <plugin_decoder offset="after_prematch">JSON_Decoder</plugin_decoder>
  <json_array_structure>array</json_array_structure>
  <json_null_field>discard</json_null_field>
  <use_own_name>true</use_own_name>
</decoder>

<decoder name="thor-json-v2">
  <parent>ossec</parent>
  <prematch offset="after_parent" type="pcre2">^output:\s+'.*thor_findings_etl\.py':\s*(?=\{)"log_version":"v2\.\d+\.\d+"</prematch>
  <plugin_decoder offset="after_prematch">JSON_Decoder</plugin_decoder>
  <json_array_structure>array</json_array_structure>
  <json_null_field>discard</json_null_field>
  <use_own_name>true</use_own_name>
</decoder>

<decoder name="thor-json-v3">
  <parent>ossec</parent>
  <prematch offset="after_parent" type="pcre2">^output:\s+'.*thor_findings_etl\.py':\s*(?=\{)"log_version":"v3\.\d+\.\d+"</prematch>
  <plugin_decoder offset="after_prematch">JSON_Decoder</plugin_decoder>
  <json_array_structure>array</json_array_structure>
  <json_null_field>discard</json_null_field>
  <use_own_name>true</use_own_name>
</decoder>

<decoder name="thor-json-default">
  <parent>ossec</parent>
  <prematch offset="after_parent" type="pcre2">^output:\s+'.*thor_findings_etl\.py':\s*(?=\{)"log_version":"v(\d+\.\d+\.\d+)"</prematch>
  <plugin_decoder offset="after_prematch">JSON_Decoder</plugin_decoder>
  <json_array_structure>array</json_array_structure>
  <json_null_field>discard</json_null_field>
  <use_own_name>true</use_own_name>
</decoder>